{"version":3,"sources":["bots.tsx","engine.tsx","App.tsx","index.tsx","styles.module.scss"],"names":["uciWorker","file","actions","worker","Worker","resolver","addEventListener","e","move","data","match","from","to","fen","Promise","resolve","reject","postMessage","forEach","action","Bots","Random","res","moves","Chess","verbose","Math","floor","random","length","setTimeout","newGame","isBlackTurn","turn","isWhiteTurn","BotSelector","playerName","availableBots","selectedBot","setSelectedBot","className","styles","value","name","onChange","target","Object","keys","map","History","history","endRef","useRef","useEffect","current","scrollIntoView","piece","color","san","join","ref","App","bots","onGameCompleted","useState","isPlaying","setPlaying","engine","setFen","setHistory","whiteBot","setWhiteBot","blackBot","setBlackBot","doMove","game","promotion","game_over","in_checkmate","isBotMovePlayable","then","TopNav","Button","onClick","playing","Chessboard","position","allowDrag","sourceSquare","isWhiteBotTurn","isBlackBotTurn","square","onDrop","targetSquare","ReactDOM","render","StrictMode","winner","global","alert","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.3d8ecd18.chunk.js","sourcesContent":["import Chess from 'chess.js';\nimport type { Fen, ShortMove } from './engine';\n\nexport type UninitialisedBot = () => InitialisedBot;\nexport type InitialisedBot = (fen: Fen) => Promise<ShortMove>;\nexport type AvailableBots = { [name: string]: UninitialisedBot };\n\nconst randomMove: UninitialisedBot = () => fen =>\n  new Promise(res => {\n    const moves = Chess(fen).moves({ verbose: true });\n    const { from, to } = moves[Math.floor(Math.random() * moves.length)];\n    setTimeout(() => res({ from, to }), 500);\n  });\n\nconst uciWorker = (file: string, actions: Array<string>): UninitialisedBot => () => {\n  const worker = new Worker(file);\n\n  let resolver: ((move: ShortMove) => void) | null = null;\n\n  worker.addEventListener('message', e => {\n    const move = e.data.match(/^bestmove\\s([a-h][1-8])([a-h][1-8])/);\n    if (move && resolver) {\n      resolver({ from: move[1], to: move[2] });\n      resolver = null;\n    }\n  });\n\n  return fen =>\n    new Promise((resolve, reject) => {\n      if (resolver) {\n        reject('Pending move is present');\n        return;\n      }\n\n      resolver = resolve;\n      worker.postMessage('ucinewgame');\n      worker.postMessage(`position fen ${fen}`);\n      actions.forEach(action => worker.postMessage(action));\n    });\n};\n\nconst Bots: AvailableBots = {\n  Random: randomMove,\n  'nmrugg/stockfish (l:1,d:10)': uciWorker('bots/stockfish.js-10.0.2/stockfish.js', [\n    'setoption name Skill Level value 1',\n    'go depth 10',\n  ]),\n  'nmrugg/stockfish (l:20,d:10)': uciWorker('bots/stockfish.js-10.0.2/stockfish.js', [\n    'setoption name Skill Level value 20',\n    'go depth 10',\n  ]),\n  'nmrugg/stockfish (l:20,t:1s)': uciWorker('bots/stockfish.js-10.0.2/stockfish.js', [\n    'setoption name Skill Level value 20',\n    'go movetime 1000',\n  ]),\n  'op12no2/lozza (l:1,d:10)': uciWorker('bots/lozza-1.18/lozza.js', [\n    'setoption name Skill Level value 1',\n    'go depth 10',\n  ]),\n  'op12no2/lozza (l:20,d:10)': uciWorker('bots/lozza-1.18/lozza.js', [\n    'setoption name Skill Level value 20',\n    'go depth 10',\n  ]),\n  'op12no2/lozza (l:20,t:1s)': uciWorker('bots/lozza-1.18/lozza.js', [\n    'setoption name Skill Level value 20',\n    'go movetime 1000',\n  ]),\n};\n\nexport default Bots;\n","import Chess from 'chess.js';\nimport type { Square, Move, ShortMove } from 'chess.js';\n\nexport type Fen = string;\nexport type GameWinner = 'b' | 'w' | null;\nexport type { Square, Move, ShortMove };\n\nexport const newGame = (): Fen => 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n\nexport const isNewGame = (fen: Fen): boolean => fen === newGame();\n\nexport const isBlackTurn = (fen: Fen): boolean => Chess(fen).turn() === 'b';\n\nexport const isWhiteTurn = (fen: Fen): boolean => Chess(fen).turn() === 'w';\n\nexport const isCheck = (fen: Fen): boolean => Chess(fen).in_check();\n\nexport const getGameWinner = (fen: Fen): GameWinner => {\n  const game = Chess(fen);\n  return game.in_checkmate() ? (game.turn() === 'w' ? 'b' : 'w') : null;\n};\n\nexport const isGameOver = (fen: Fen): boolean => Chess(fen).game_over();\n\nexport const isMoveable = (fen: Fen, from: Square): boolean =>\n  new Chess(fen).moves({ square: from }).length > 0;\n\nexport const move = (fen: Fen, from: Square, to: Square): [Fen, Move] | null => {\n  const game = Chess(fen);\n  const action = game.move({ from, to, promotion: 'q' });\n  return action ? [game.fen(), action] : null;\n};\n","import React, { useState, useEffect, useRef, ChangeEvent } from 'react';\nimport Chessboard from 'chessboardjsx';\nimport * as engine from './engine';\nimport type { AvailableBots, InitialisedBot } from './bots';\nimport styles from './styles.module.scss';\n\ntype SelectedBot = {\n  name: string;\n  move: InitialisedBot;\n} | null;\n\nconst BotSelector: React.FC<{\n  playerName: string;\n  availableBots: AvailableBots;\n  selectedBot: SelectedBot;\n  setSelectedBot: (bot: SelectedBot) => void;\n}> = ({ playerName, availableBots, selectedBot, setSelectedBot }) => {\n  const handleChange = (e: ChangeEvent<HTMLSelectElement>): void => {\n    const name = e.target.value;\n    setSelectedBot(name ? { name, move: availableBots[name]() } : null);\n  };\n\n  return (\n    <div className={styles.BotSelector}>\n      <label>{playerName}</label>\n      <select value={selectedBot?.name} onChange={handleChange}>\n        <option value=\"\" key=\"User\">\n          User\n        </option>\n        {Object.keys(availableBots).map(name => (\n          <option key={name}>{name}</option>\n        ))}\n      </select>\n    </div>\n  );\n};\n\nconst History: React.FC<{ history: Array<engine.Move> }> = ({ history }) => {\n  const endRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    endRef.current?.scrollIntoView();\n  }, [history]);\n\n  return (\n    <pre className={styles.History}>\n      {history.map(({ piece, color, from, san }) => `${color}${piece}${from} ${san}`).join('\\n')}\n      <div ref={endRef} />\n    </pre>\n  );\n};\n\nconst App: React.FC<{\n  bots: AvailableBots;\n  onGameCompleted: (winner: engine.GameWinner) => void;\n}> = ({ bots, onGameCompleted }) => {\n  const [isPlaying, setPlaying] = useState<boolean>(false);\n  const [fen, setFen] = useState<engine.Fen>(engine.newGame);\n  const [history, setHistory] = useState<Array<engine.Move>>([]);\n  const [whiteBot, setWhiteBot] = useState<SelectedBot>(null);\n  const [blackBot, setBlackBot] = useState<SelectedBot>(null);\n\n  const newGame = () => {\n    setPlaying(false);\n    setFen(engine.newGame);\n    setHistory([]);\n  };\n\n  const doMove = (from: engine.Square, to: engine.Square) => {\n    const move = engine.move(fen, from, to);\n\n    if (move) {\n      const [fen, action] = move;\n\n      if (engine.isGameOver(fen)) {\n        onGameCompleted(engine.getGameWinner(fen));\n        newGame();\n        return;\n      }\n\n      setFen(fen);\n      setHistory(history => [...history, action]);\n    }\n  };\n\n  const onDragStart = ({ sourceSquare: from }: { sourceSquare: engine.Square }) => {\n    const isWhiteBotTurn = whiteBot && engine.isWhiteTurn(fen);\n    const isBlackBotTurn = blackBot && engine.isBlackTurn(fen);\n\n    return isPlaying && engine.isMoveable(fen, from) && !(isWhiteBotTurn || isBlackBotTurn);\n  };\n\n  const onMovePiece = ({\n    sourceSquare: from,\n    targetSquare: to,\n  }: {\n    sourceSquare: engine.Square;\n    targetSquare: engine.Square;\n  }) => {\n    doMove(from, to);\n  };\n\n  useEffect(() => {\n    if (!isPlaying) {\n      return;\n    }\n\n    let isBotMovePlayable = true;\n\n    if (whiteBot && engine.isWhiteTurn(fen)) {\n      whiteBot.move(fen).then(({ from, to }) => {\n        if (isBotMovePlayable) doMove(from, to);\n      });\n    }\n\n    if (blackBot && engine.isBlackTurn(fen)) {\n      blackBot.move(fen).then(({ from, to }) => {\n        if (isBotMovePlayable) doMove(from, to);\n      });\n    }\n\n    return () => {\n      isBotMovePlayable = false;\n    };\n  }, [isPlaying, fen, whiteBot, blackBot]);\n\n  return (\n    <div className={styles.App}>\n      <header>\n        <h1>♛ Chessbot</h1>\n      </header>\n      <div className={styles.TopNav}>\n        <BotSelector\n          playerName=\"White\"\n          availableBots={bots}\n          selectedBot={whiteBot}\n          setSelectedBot={setWhiteBot}\n        />\n        <BotSelector\n          playerName=\"Black\"\n          availableBots={bots}\n          selectedBot={blackBot}\n          setSelectedBot={setBlackBot}\n        />\n        <button className={styles.Button} onClick={() => setPlaying(playing => !playing)}>\n          {isPlaying ? 'Pause' : 'Play'}\n        </button>\n        <button className={styles.Button} onClick={newGame}>\n          Reset\n        </button>\n      </div>\n      <div className={styles.Chessboard}>\n        <Chessboard position={fen} allowDrag={onDragStart} onDrop={onMovePiece} />\n      </div>\n      <History history={history} />\n    </div>\n  );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport bots from './bots';\nimport './new-1.1.3.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App\n      bots={bots}\n      onGameCompleted={winner => {\n        global.alert(\n          `${winner === 'b' ? 'Black' : winner === 'w' ? 'White' : 'No one'} is the winner!`\n        );\n      }}\n    />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App\":\"styles_App__fFNuF\",\"TopNav\":\"styles_TopNav__3Zi02\",\"Button\":\"styles_Button__3HbKX\",\"BotSelector\":\"styles_BotSelector__1sHbn\",\"Chessboard\":\"styles_Chessboard__owj1A\",\"History\":\"styles_History__7Rgl8\"};"],"sourceRoot":""}